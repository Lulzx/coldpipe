{% extends "base.html" %}
{% block title %}{{ 'Edit' if mailbox else 'Add' }} Mailbox - Coldpipe{% endblock %}
{% block content %}
<div class="page-header d-print-none mb-3">
  <div class="row align-items-center">
    <div class="col">
      <a href="/mailboxes" class="text-muted mb-1 d-block">&#8592; Back to mailboxes</a>
      <h2 class="page-title">{{ 'Edit' if mailbox else 'Add' }} Mailbox</h2>
    </div>
  </div>
</div>

<div class="card">
  <div class="card-body">
    <form method="post" action="{{ '/mailboxes/%d/edit'|format(mailbox.id) if mailbox else '/mailboxes/add' }}">
      <input type="hidden" name="_csrf" value="{{ csrf_token }}">
      {% if not mailbox %}
      <div class="mb-3">
        <label class="form-label required">Email Address</label>
        <input type="email" name="email" class="form-control" required>
      </div>
      {% endif %}
      <div class="mb-3">
        <label class="form-label">Display Name</label>
        <input type="text" name="display_name" class="form-control" value="{{ mailbox.display_name if mailbox else '' }}">
      </div>

      <h3 class="mt-4 mb-3">SMTP Settings</h3>
      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label required">SMTP Host</label>
          <input type="text" name="smtp_host" class="form-control" value="{{ mailbox.smtp_host if mailbox else 'smtp.gmail.com' }}" required>
        </div>
        <div class="col-md-6 mb-3">
          <label class="form-label required">SMTP Port</label>
          <input type="number" name="smtp_port" class="form-control" value="{{ mailbox.smtp_port if mailbox else 587 }}" required>
        </div>
      </div>
      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label">SMTP User</label>
          <input type="text" name="smtp_user" class="form-control" value="{{ mailbox.smtp_user if mailbox else '' }}">
        </div>
        <div class="col-md-6 mb-3">
          <label class="form-label">SMTP Password</label>
          <input type="password" name="smtp_pass" class="form-control" placeholder="{{ '(unchanged)' if mailbox else '' }}">
        </div>
      </div>

      <h3 class="mt-4 mb-3">IMAP Settings</h3>
      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label required">IMAP Host</label>
          <input type="text" name="imap_host" class="form-control" value="{{ mailbox.imap_host if mailbox else 'imap.gmail.com' }}" required>
        </div>
        <div class="col-md-6 mb-3">
          <label class="form-label required">IMAP Port</label>
          <input type="number" name="imap_port" class="form-control" value="{{ mailbox.imap_port if mailbox else 993 }}" required>
        </div>
      </div>
      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label">IMAP User</label>
          <input type="text" name="imap_user" class="form-control" value="{{ mailbox.imap_user if mailbox else '' }}">
        </div>
        <div class="col-md-6 mb-3">
          <label class="form-label">IMAP Password</label>
          <input type="password" name="imap_pass" class="form-control" placeholder="{{ '(unchanged)' if mailbox else '' }}">
        </div>
      </div>

      <h3 class="mt-4 mb-3">Limits</h3>
      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label">Daily Limit</label>
          <input type="number" name="daily_limit" class="form-control" value="{{ mailbox.daily_limit if mailbox else 30 }}">
        </div>
        <div class="col-md-6 mb-3 d-flex align-items-end">
          <label class="form-check">
            <input type="checkbox" name="is_active" class="form-check-input" value="1"{% if not mailbox or mailbox.is_active %} checked{% endif %}>
            <span class="form-check-label">Active</span>
          </label>
        </div>
      </div>

      <div class="mt-3">
        <button type="submit" class="btn btn-primary">{{ 'Save Changes' if mailbox else 'Add Mailbox' }}</button>
        <a href="/mailboxes" class="btn ms-2">Cancel</a>
      </div>
    </form>
  </div>
</div>
{% endblock %}
